# 4.4 Software Description

## Project Overview

**SkillSphere** is a comprehensive Learning Management System (LMS) designed to facilitate online education through course management, progress tracking, quizzes, and certificate generation. The system supports multiple user roles including Students, Experts (Instructors), Admins, and Super Admins.

## Technology Stack

| Component | Technology |
|-----------|------------|
| Backend | Node.js, Express.js 4.18.2 |
| Database | MySQL 8.0+ (Sequelize ORM) |
| Frontend | React Native 0.72.6 with React Native Web |
| Authentication | JWT, Firebase Admin SDK (Google OAuth) |
| AI Integration | Google Gemini API |
| File Storage | Cloudinary |
| Email Service | Nodemailer (Gmail SMTP) |

---

## Main Modules

The SkillSphere LMS consists of the following core modules:

1. **User Authentication & Management Module**
2. **Course Management Module**
3. **Enrollment & Progress Tracking Module**
4. **Quiz Management Module**
5. **Certificate Management Module**
6. **AI Learning Assistant Module**
7. **Notification Management Module**

---

## 4.4.1 User Authentication & Management Module

### Description
This module handles all user authentication operations including registration, login, password recovery, and Google OAuth integration. It supports multi-role access control with four distinct user types.

### Input
- User credentials (email, password)
- Registration details (name, email, phone, password)
- OTP codes for verification
- Google OAuth tokens

### Output
- JWT authentication tokens (7-day validity)
- User profile information
- Authentication status messages

### Code Implementation

**File:** `backend/controllers/authController.js`

```javascript
exports.login = async (req, res) => {
  try {
    const { email, password } = req.body;

    // Find user by email
    const user = await User.findOne({ where: { email } });

    if (!user) {
      return res.status(401).json({ message: 'Invalid credentials' });
    }

    // Verify password
    const isMatch = await user.comparePassword(password);
    if (!isMatch) {
      return res.status(401).json({ message: 'Invalid credentials' });
    }

    // Check if user is active
    if (!user.isActive) {
      return res.status(403).json({ message: 'Account is deactivated' });
    }

    // Generate JWT token
    const token = jwt.sign(
      { userId: user.id, email: user.email, role: user.role },
      process.env.JWT_SECRET,
      { expiresIn: '7d' }
    );

    res.json({
      message: 'Login successful',
      token,
      user: {
        id: user.id,
        name: user.name,
        email: user.email,
        role: user.role,
        profilePicture: user.profilePicture
      }
    });
  } catch (error) {
    res.status(500).json({ message: 'Server error', error: error.message });
  }
};
```

**Figure 4.1: User Authentication Flow**

> **Screenshot to paste:** Login screen showing email/password fields with "Login" and "Sign up" buttons, Google OAuth option visible.

### OTP Verification System

```javascript
exports.sendOTP = async (req, res) => {
  try {
    const { email, name } = req.body;

    // Check if email already exists
    const existingUser = await User.findOne({ where: { email } });
    if (existingUser) {
      return res.status(400).json({ message: 'Email already registered' });
    }

    // Generate 6-digit OTP
    const otpCode = Math.floor(100000 + Math.random() * 900000).toString();
    const otpExpiry = new Date(Date.now() + 10 * 60 * 1000); // 10 minutes

    // Store OTP temporarily
    await TempOTP.create({
      email,
      name,
      otpCode,
      otpExpiry
    });

    // Send OTP email
    await emailService.sendOTPEmail(email, name, otpCode);

    res.json({ message: 'OTP sent successfully' });
  } catch (error) {
    res.status(500).json({ message: 'Failed to send OTP' });
  }
};
```

**Figure 4.2: OTP Verification Screen**

> **Screenshot to paste:** OTP entry screen with 6-digit input fields and "Verify" button.

### User Roles and Permissions

| Role | Permissions |
|------|-------------|
| Student | Browse courses, enroll, track progress, take quizzes, earn certificates |
| Expert | Create/manage courses, add materials, create quizzes, view feedback |
| Admin | Manage users, manage courses, manage categories, view analytics |
| SuperAdmin | Full system access, manage admins, system configuration |

---

## 4.4.2 Course Management Module

### Description
This module enables course creation, management, and publishing. Experts can create courses with multiple topics and learning materials (videos, PDFs, images, links).

### Input
- Course details (name, description, level, language, duration)
- Category selection
- Topic information (title, order)
- Learning materials (files, links)
- Thumbnail image

### Output
- Course listing with enrollment counts
- Published/draft course status
- Organized topic and material structure

### Code Implementation

**File:** `backend/controllers/courseController.js`

```javascript
exports.createCourse = async (req, res) => {
  try {
    const { name, description, level, language, duration, categoryId } = req.body;
    const userId = req.user.id;

    // Create course
    const course = await Course.create({
      name,
      description,
      level,
      language,
      duration,
      categoryId,
      userId,
      status: 'draft',
      thumbnailImage: req.file ? req.file.path : null
    });

    res.status(201).json({
      message: 'Course created successfully',
      course
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to create course' });
  }
};

exports.publishCourse = async (req, res) => {
  try {
    const { id } = req.params;

    const course = await Course.findByPk(id, {
      include: [{ model: Topic, include: [Material] }]
    });

    if (!course) {
      return res.status(404).json({ message: 'Course not found' });
    }

    // Validate course has at least one topic with materials
    if (course.Topics.length === 0) {
      return res.status(400).json({
        message: 'Course must have at least one topic before publishing'
      });
    }

    course.status = course.status === 'published' ? 'draft' : 'published';
    await course.save();

    res.json({
      message: `Course ${course.status === 'published' ? 'published' : 'unpublished'} successfully`,
      course
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to update course status' });
  }
};
```

**Figure 4.3: Course Creation Form**

> **Screenshot to paste:** Create Course screen showing form fields for course name, description, level dropdown, language selection, duration input, and category picker.

### Course Data Model

**File:** `backend/models/Course.js`

```javascript
const Course = sequelize.define('Course', {
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  name: {
    type: DataTypes.STRING(255),
    allowNull: false
  },
  description: {
    type: DataTypes.TEXT,
    allowNull: true
  },
  level: {
    type: DataTypes.ENUM('Beginner', 'Intermediate', 'Advanced'),
    defaultValue: 'Beginner'
  },
  language: {
    type: DataTypes.ENUM('English', 'Urdu'),
    defaultValue: 'English'
  },
  duration: {
    type: DataTypes.STRING(50),
    allowNull: true
  },
  status: {
    type: DataTypes.ENUM('draft', 'published'),
    defaultValue: 'draft'
  },
  thumbnailImage: {
    type: DataTypes.STRING(500),
    allowNull: true
  }
});
```

**Figure 4.4: Course Listing Dashboard**

> **Screenshot to paste:** Course listing page showing multiple course cards with thumbnails, titles, enrollment counts, and status badges (Published/Draft).

### Topic and Material Management

```javascript
exports.createTopic = async (req, res) => {
  try {
    const { title, courseId, order } = req.body;

    const topic = await Topic.create({
      title,
      courseId,
      order,
      status: 'locked',
      completed: false
    });

    res.status(201).json({
      message: 'Topic created successfully',
      topic
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to create topic' });
  }
};

exports.addMaterial = async (req, res) => {
  try {
    const { type, title, uri, description, courseId, topicId } = req.body;

    const material = await Material.create({
      type, // pdf, video, image, link, command
      title,
      uri,
      description,
      courseId,
      topicId
    });

    res.status(201).json({
      message: 'Material added successfully',
      material
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to add material' });
  }
};
```

**Figure 4.5: Topic Management Interface**

> **Screenshot to paste:** Add Topics screen showing list of topics with drag handles for reordering, "Add Topic" button, and material count per topic.

---

## 4.4.3 Enrollment & Progress Tracking Module

### Description
This module manages student enrollments in courses and tracks their learning progress at the topic level. Progress is automatically calculated based on completed topics.

### Input
- Course ID for enrollment
- Topic completion status
- Time spent on each topic

### Output
- Enrollment status (enrolled, in-progress, completed, dropped)
- Progress percentage
- Learning statistics
- Completion timestamps

### Code Implementation

**File:** `backend/controllers/enrollmentController.js`

```javascript
exports.enrollInCourse = async (req, res) => {
  try {
    const { courseId } = req.body;
    const userId = req.user.id;

    // Check if course exists and is published
    const course = await Course.findOne({
      where: { id: courseId, status: 'published' }
    });

    if (!course) {
      return res.status(404).json({ message: 'Course not found or not available' });
    }

    // Check existing enrollment
    const existingEnrollment = await Enrollment.findOne({
      where: { userId, courseId }
    });

    if (existingEnrollment) {
      return res.status(400).json({ message: 'Already enrolled in this course' });
    }

    // Create enrollment
    const enrollment = await Enrollment.create({
      userId,
      courseId,
      status: 'enrolled',
      progressPercentage: 0,
      enrolledAt: new Date()
    });

    // Create notification
    await Notification.create({
      userId,
      title: 'Enrollment Successful',
      message: `You have successfully enrolled in "${course.name}"`,
      type: 'course',
      relatedId: courseId,
      relatedType: 'course'
    });

    res.status(201).json({
      message: 'Enrolled successfully',
      enrollment
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to enroll' });
  }
};
```

**Figure 4.6: Course Enrollment Screen**

> **Screenshot to paste:** Course detail page with "Enroll Now" button, course description, instructor info, and course syllabus preview.

### Progress Tracking System

**File:** `backend/controllers/progressController.js`

```javascript
exports.updateTopicProgress = async (req, res) => {
  try {
    const { courseId, topicId, completed, timeSpent } = req.body;
    const userId = req.user.id;

    // Update or create progress record
    const [progress, created] = await Progress.findOrCreate({
      where: { userId, courseId, topicId },
      defaults: {
        completed: completed || false,
        timeSpent: timeSpent || 0,
        completedAt: completed ? new Date() : null
      }
    });

    if (!created) {
      progress.completed = completed;
      progress.timeSpent = (progress.timeSpent || 0) + (timeSpent || 0);
      if (completed) {
        progress.completedAt = new Date();
      }
      await progress.save();
    }

    // Calculate overall course progress
    const totalTopics = await Topic.count({ where: { courseId } });
    const completedTopics = await Progress.count({
      where: { userId, courseId, completed: true }
    });

    const progressPercentage = Math.round((completedTopics / totalTopics) * 100);

    // Update enrollment progress
    await Enrollment.update(
      {
        progressPercentage,
        status: progressPercentage === 100 ? 'completed' : 'in-progress',
        completedAt: progressPercentage === 100 ? new Date() : null
      },
      { where: { userId, courseId } }
    );

    res.json({
      message: 'Progress updated',
      progress,
      overallProgress: progressPercentage
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to update progress' });
  }
};

exports.getLearningStats = async (req, res) => {
  try {
    const userId = req.user.id;

    const stats = {
      totalEnrolled: await Enrollment.count({ where: { userId } }),
      inProgress: await Enrollment.count({
        where: { userId, status: 'in-progress' }
      }),
      completed: await Enrollment.count({
        where: { userId, status: 'completed' }
      }),
      totalTimeSpent: await Progress.sum('timeSpent', { where: { userId } }),
      certificatesEarned: await Certificate.count({ where: { userId } })
    };

    res.json(stats);
  } catch (error) {
    res.status(500).json({ message: 'Failed to fetch stats' });
  }
};
```

**Figure 4.7: Student Progress Dashboard**

> **Screenshot to paste:** Student dashboard showing enrolled courses with progress bars, completion percentages, and learning statistics cards (courses enrolled, in progress, completed).

**Figure 4.8: Learning Screen with Topic Progress**

> **Screenshot to paste:** Learning screen showing course topics list with checkmarks for completed topics, locked/unlocked status icons, and "Mark Complete" button.

---

## 4.4.4 Quiz Management Module

### Description
This module allows experts to create quizzes for their courses and enables students to take quizzes with automatic grading. Quiz results are tracked for each attempt.

### Input
- Quiz questions with multiple choice options
- Student answers
- Time taken for quiz completion

### Output
- Quiz score (0-100)
- Pass/fail status
- Correct answers count
- Attempt history

### Code Implementation

**File:** `backend/controllers/quizController.js`

```javascript
exports.submitQuiz = async (req, res) => {
  try {
    const { quizId, answers, timeTaken } = req.body;
    const userId = req.user.id;

    // Get quiz with correct answers
    const quiz = await Quiz.findByPk(quizId);
    if (!quiz) {
      return res.status(404).json({ message: 'Quiz not found' });
    }

    // Calculate score
    const questions = quiz.questions;
    let correctAnswers = 0;

    questions.forEach((question, index) => {
      if (answers[index] === question.correctAnswer) {
        correctAnswers++;
      }
    });

    const score = Math.round((correctAnswers / questions.length) * 100);
    const passed = score >= quiz.passingScore;

    // Get attempt number
    const previousAttempts = await QuizResult.count({
      where: { userId, quizId }
    });

    // Save result
    const result = await QuizResult.create({
      userId,
      quizId,
      courseId: quiz.courseId,
      answers,
      score,
      correctAnswers,
      totalQuestions: questions.length,
      passed,
      timeTaken,
      attemptNumber: previousAttempts + 1,
      submittedAt: new Date()
    });

    // Create notification
    await Notification.create({
      userId,
      title: passed ? 'Quiz Passed!' : 'Quiz Completed',
      message: `You scored ${score}% on "${quiz.title}"`,
      type: 'quiz',
      relatedId: quizId,
      relatedType: 'quiz'
    });

    res.json({
      message: passed ? 'Congratulations! You passed!' : 'Quiz completed',
      result: {
        score,
        correctAnswers,
        totalQuestions: questions.length,
        passed,
        passingScore: quiz.passingScore
      }
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to submit quiz' });
  }
};
```

**Figure 4.9: Quiz Taking Interface**

> **Screenshot to paste:** Quiz screen showing a question with multiple choice options (radio buttons), question counter (e.g., "Question 3 of 10"), and timer display.

### Quiz Data Model

```javascript
const Quiz = sequelize.define('Quiz', {
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  title: {
    type: DataTypes.STRING(255),
    allowNull: false
  },
  description: {
    type: DataTypes.TEXT
  },
  questions: {
    type: DataTypes.JSON,
    allowNull: false
    // Format: [{id, question, options: [], correctAnswer}]
  },
  passingScore: {
    type: DataTypes.INTEGER,
    defaultValue: 70
  },
  timeLimit: {
    type: DataTypes.INTEGER, // minutes
    allowNull: true
  },
  isActive: {
    type: DataTypes.BOOLEAN,
    defaultValue: true
  }
});
```

**Figure 4.10: Quiz Result Screen**

> **Screenshot to paste:** Quiz result screen showing score percentage, pass/fail status, correct/incorrect answer breakdown, and "Retake Quiz" button.

---

## 4.4.5 Certificate Management Module

### Description
This module generates and manages certificates for students who complete courses. Each certificate has a unique verification number and can be publicly verified.

### Input
- Course completion status
- Student information
- Certificate template settings

### Output
- Unique certificate number
- Certificate PDF/image
- Public verification link
- Issue date and grade

### Code Implementation

**File:** `backend/controllers/certificateController.js`

```javascript
exports.generateCertificate = async (req, res) => {
  try {
    const { courseId } = req.body;
    const userId = req.user.id;

    // Check enrollment completion
    const enrollment = await Enrollment.findOne({
      where: { userId, courseId, status: 'completed' }
    });

    if (!enrollment) {
      return res.status(400).json({
        message: 'Course must be completed to generate certificate'
      });
    }

    // Check if certificate already exists
    const existingCert = await Certificate.findOne({
      where: { userId, courseId }
    });

    if (existingCert) {
      return res.status(400).json({
        message: 'Certificate already generated',
        certificate: existingCert
      });
    }

    // Generate unique certificate number
    const timestamp = Date.now();
    const random = Math.random().toString(36).substring(2, 8).toUpperCase();
    const certificateNumber = `CERT-${userId}-${courseId}-${timestamp}-${random}`;

    // Calculate grade based on quiz performance
    const quizResults = await QuizResult.findAll({
      where: { userId, courseId, passed: true }
    });

    let grade = 'Completed';
    if (quizResults.length > 0) {
      const avgScore = quizResults.reduce((sum, r) => sum + r.score, 0) / quizResults.length;
      if (avgScore >= 90) grade = 'Distinction';
      else if (avgScore >= 80) grade = 'Merit';
      else if (avgScore >= 70) grade = 'Pass';
    }

    // Create certificate record
    const certificate = await Certificate.create({
      userId,
      courseId,
      certificateNumber,
      issuedDate: new Date(),
      grade,
      verificationUrl: `${process.env.FRONTEND_URL}/verify/${certificateNumber}`
    });

    // Send certificate email
    const user = await User.findByPk(userId);
    const course = await Course.findByPk(courseId);
    await emailService.sendCertificateEmail(user.email, user.name, course.name, certificateNumber);

    res.status(201).json({
      message: 'Certificate generated successfully',
      certificate
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to generate certificate' });
  }
};

exports.verifyCertificate = async (req, res) => {
  try {
    const { certificateNumber } = req.params;

    const certificate = await Certificate.findOne({
      where: { certificateNumber },
      include: [
        { model: User, attributes: ['name', 'email'] },
        { model: Course, attributes: ['name', 'description', 'level'] }
      ]
    });

    if (!certificate) {
      return res.status(404).json({
        valid: false,
        message: 'Certificate not found'
      });
    }

    res.json({
      valid: true,
      certificate: {
        studentName: certificate.User.name,
        courseName: certificate.Course.name,
        courseLevel: certificate.Course.level,
        issuedDate: certificate.issuedDate,
        grade: certificate.grade,
        certificateNumber: certificate.certificateNumber
      }
    });
  } catch (error) {
    res.status(500).json({ message: 'Verification failed' });
  }
};
```

**Figure 4.11: Certificate Display Screen**

> **Screenshot to paste:** Certificate screen showing earned certificate with student name, course name, completion date, grade badge, and verification QR code.

**Figure 4.12: Certificate Verification Page**

> **Screenshot to paste:** Public certificate verification page showing "Certificate Verified" status with certificate details (student name, course, issue date).

---

## 4.4.6 AI Learning Assistant Module

### Description
This module integrates Google Gemini AI to provide students with an intelligent learning assistant. Students can ask questions about their courses and get AI-powered explanations.

### Input
- User questions/messages
- Chat session context
- Course-related queries

### Output
- AI-generated responses
- Chat history
- Session management

### Code Implementation

**File:** `backend/services/geminiService.js`

```javascript
const { GoogleGenerativeAI } = require('@google/generative-ai');

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
const model = genAI.getGenerativeModel({ model: 'gemini-pro' });

exports.generateResponse = async (userMessage, chatHistory = []) => {
  try {
    const systemPrompt = `You are SkillSphere AI, an intelligent learning assistant.
    Help students understand course concepts, answer questions about their learning materials,
    and provide explanations in a clear, educational manner. Be encouraging and supportive.`;

    // Build conversation context
    const messages = chatHistory.map(msg => ({
      role: msg.sender === 'user' ? 'user' : 'model',
      parts: [{ text: msg.content }]
    }));

    const chat = model.startChat({
      history: messages,
      generationConfig: {
        maxOutputTokens: 1000,
        temperature: 0.7
      }
    });

    const result = await chat.sendMessage(userMessage);
    const response = await result.response;

    return response.text();
  } catch (error) {
    console.error('Gemini API error:', error);
    throw new Error('Failed to generate AI response');
  }
};
```

**File:** `backend/controllers/aiChatController.js`

```javascript
exports.sendMessage = async (req, res) => {
  try {
    const { sessionId } = req.params;
    const { content } = req.body;
    const userId = req.user.id;

    // Verify session ownership
    const session = await AIChatSession.findOne({
      where: { id: sessionId, userId }
    });

    if (!session) {
      return res.status(404).json({ message: 'Session not found' });
    }

    // Save user message
    await AIChatMessage.create({
      sessionId,
      content,
      sender: 'user',
      timestamp: new Date()
    });

    // Get chat history for context
    const history = await AIChatMessage.findAll({
      where: { sessionId },
      order: [['timestamp', 'ASC']],
      limit: 20
    });

    // Generate AI response
    const aiResponse = await geminiService.generateResponse(content, history);

    // Save AI response
    const aiMessage = await AIChatMessage.create({
      sessionId,
      content: aiResponse,
      sender: 'ai',
      timestamp: new Date()
    });

    // Update session last message time
    session.lastMessageAt = new Date();
    await session.save();

    res.json({
      message: aiMessage,
      sessionId
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to send message' });
  }
};
```

**Figure 4.13: AI Chat Interface**

> **Screenshot to paste:** AI Chat screen showing conversation bubbles with user messages and AI responses, message input field at bottom, and chat session list in sidebar.

---

## 4.4.7 Notification Management Module

### Description
This module handles all system notifications including enrollment confirmations, quiz results, certificate generation, and system announcements.

### Input
- Notification triggers (enrollment, quiz submission, course completion)
- Notification content (title, message, type)
- Target user ID

### Output
- Real-time notification delivery
- Read/unread status tracking
- Notification history

### Code Implementation

**File:** `backend/controllers/notificationController.js`

```javascript
exports.getMyNotifications = async (req, res) => {
  try {
    const userId = req.user.id;

    const notifications = await Notification.findAll({
      where: { userId },
      order: [['createdAt', 'DESC']],
      limit: 50
    });

    const unreadCount = await Notification.count({
      where: { userId, isRead: false }
    });

    res.json({
      notifications,
      unreadCount
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to fetch notifications' });
  }
};

exports.markAsRead = async (req, res) => {
  try {
    const { id } = req.params;
    const userId = req.user.id;

    const notification = await Notification.findOne({
      where: { id, userId }
    });

    if (!notification) {
      return res.status(404).json({ message: 'Notification not found' });
    }

    notification.isRead = true;
    await notification.save();

    res.json({ message: 'Marked as read' });
  } catch (error) {
    res.status(500).json({ message: 'Failed to update notification' });
  }
};

exports.markAllAsRead = async (req, res) => {
  try {
    const userId = req.user.id;

    await Notification.update(
      { isRead: true },
      { where: { userId, isRead: false } }
    );

    res.json({ message: 'All notifications marked as read' });
  } catch (error) {
    res.status(500).json({ message: 'Failed to update notifications' });
  }
};
```

### Notification Types

| Type | Trigger | Example Message |
|------|---------|-----------------|
| `course` | Enrollment | "You have successfully enrolled in Python Basics" |
| `quiz` | Quiz Submission | "You scored 85% on Module 1 Quiz" |
| `certificate` | Certificate Generated | "Your certificate for Web Development is ready" |
| `info` | System Updates | "New courses available in your category" |
| `warning` | Account Alerts | "Your session will expire soon" |
| `success` | Achievements | "Congratulations on completing your first course!" |

**Figure 4.14: Notifications Screen**

> **Screenshot to paste:** Notifications screen showing list of notifications with icons, timestamps, read/unread indicators, and "Mark all as read" button.

---

## 4.4.8 Admin Management Module

### Description
This module provides administrative capabilities for managing users, courses, categories, and system settings. It includes role-based access control with different permission levels.

### Input
- Admin credentials
- User management actions (activate, deactivate, change role)
- Course approval/rejection
- Category management

### Output
- User listings with status
- Course management interface
- System analytics
- Permission management

### Code Implementation

**File:** `backend/controllers/adminController.js`

```javascript
exports.getAllUsers = async (req, res) => {
  try {
    const { role, status, search } = req.query;

    const whereClause = {};
    if (role) whereClause.role = role;
    if (status) whereClause.isActive = status === 'active';
    if (search) {
      whereClause[Op.or] = [
        { name: { [Op.like]: `%${search}%` } },
        { email: { [Op.like]: `%${search}%` } }
      ];
    }

    const users = await User.findAll({
      where: whereClause,
      attributes: { exclude: ['password', 'otpCode', 'otpExpiry'] },
      order: [['createdAt', 'DESC']]
    });

    res.json(users);
  } catch (error) {
    res.status(500).json({ message: 'Failed to fetch users' });
  }
};

exports.updateUserStatus = async (req, res) => {
  try {
    const { id } = req.params;
    const { isActive } = req.body;

    const user = await User.findByPk(id);
    if (!user) {
      return res.status(404).json({ message: 'User not found' });
    }

    // Prevent deactivating superadmin
    if (user.role === 'superadmin') {
      return res.status(403).json({ message: 'Cannot modify superadmin' });
    }

    user.isActive = isActive;
    await user.save();

    res.json({
      message: `User ${isActive ? 'activated' : 'deactivated'} successfully`
    });
  } catch (error) {
    res.status(500).json({ message: 'Failed to update user status' });
  }
};

exports.updateUserRole = async (req, res) => {
  try {
    const { id } = req.params;
    const { role, permissions } = req.body;

    const user = await User.findByPk(id);
    if (!user) {
      return res.status(404).json({ message: 'User not found' });
    }

    if (user.role === 'superadmin') {
      return res.status(403).json({ message: 'Cannot modify superadmin role' });
    }

    user.role = role;
    if (permissions) {
      user.permissions = permissions;
    }
    await user.save();

    res.json({ message: 'User role updated successfully' });
  } catch (error) {
    res.status(500).json({ message: 'Failed to update user role' });
  }
};
```

**Figure 4.15: Admin Dashboard**

> **Screenshot to paste:** Admin dashboard showing statistics cards (total users, courses, enrollments), recent activity feed, and quick action buttons.

**Figure 4.16: User Management Screen**

> **Screenshot to paste:** Manage Users screen with user table (name, email, role, status), search bar, filter dropdowns, and action buttons (Edit, Activate/Deactivate).

**Figure 4.17: Category Management Screen**

> **Screenshot to paste:** Category management interface showing list of categories with course counts, "Add Category" button, and edit/delete actions.

---

## System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                        CLIENT LAYER                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │   Web App   │  │ Android App │  │   iOS App   │              │
│  │ (React Web) │  │   (Expo)    │  │   (Expo)    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
│         └────────────────┼────────────────┘                     │
└─────────────────────────┬───────────────────────────────────────┘
                          │ HTTPS/REST API
┌─────────────────────────┴───────────────────────────────────────┐
│                      API GATEWAY LAYER                           │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              Express.js Server (Node.js)                 │    │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐        │    │
│  │  │  Auth   │ │ Course  │ │  Quiz   │ │  Cert   │        │    │
│  │  │ Routes  │ │ Routes  │ │ Routes  │ │ Routes  │        │    │
│  │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘        │    │
│  │       │           │           │           │              │    │
│  │  ┌────┴────┐ ┌────┴────┐ ┌────┴────┐ ┌────┴────┐        │    │
│  │  │  Auth   │ │ Course  │ │  Quiz   │ │  Cert   │        │    │
│  │  │Controller│ │Controller│ │Controller│ │Controller│        │    │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘        │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────┬───────────────────────────────────────┘
                          │
┌─────────────────────────┴───────────────────────────────────────┐
│                      SERVICE LAYER                               │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐                 │
│  │   Email    │  │Certificate │  │  Gemini    │                 │
│  │  Service   │  │  Service   │  │  AI Chat   │                 │
│  └────────────┘  └────────────┘  └────────────┘                 │
└─────────────────────────┬───────────────────────────────────────┘
                          │
┌─────────────────────────┴───────────────────────────────────────┐
│                      DATA LAYER                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                Sequelize ORM                             │    │
│  │  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐  │    │
│  │  │ User │ │Course│ │ Quiz │ │ Cert │ │Enroll│ │Progrs│  │    │
│  │  │Model │ │Model │ │Model │ │Model │ │Model │ │Model │  │    │
│  │  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘  │    │
│  └─────────────────────────────────────────────────────────┘    │
│                            │                                     │
│  ┌─────────────────────────┴───────────────────────────────┐    │
│  │                    MySQL Database                        │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                          │
┌─────────────────────────┴───────────────────────────────────────┐
│                   EXTERNAL SERVICES                              │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐                 │
│  │ Cloudinary │  │  Firebase  │  │   Gmail    │                 │
│  │  (Files)   │  │  (OAuth)   │  │  (SMTP)    │                 │
│  └────────────┘  └────────────┘  └────────────┘                 │
└─────────────────────────────────────────────────────────────────┘
```

**Figure 4.18: System Architecture Diagram**

> **Screenshot to paste:** Create this architecture diagram using draw.io, Lucidchart, or similar tool based on the ASCII representation above.

---

## Database Entity Relationship Diagram

```
┌──────────────────┐       ┌──────────────────┐
│      User        │       │     Category     │
├──────────────────┤       ├──────────────────┤
│ id (PK)          │       │ id (PK)          │
│ name             │       │ name             │
│ email            │       │ createdAt        │
│ password         │       └────────┬─────────┘
│ phone            │                │
│ role             │                │ 1:N
│ isActive         │                │
│ permissions      │       ┌────────┴─────────┐
│ profilePicture   │       │     Course       │
└────────┬─────────┘       ├──────────────────┤
         │                 │ id (PK)          │
         │ 1:N             │ name             │
         │                 │ description      │
┌────────┴─────────┐       │ level            │
│   Enrollment     │       │ language         │
├──────────────────┤       │ duration         │
│ id (PK)          │       │ status           │
│ userId (FK)      │──────►│ categoryId (FK)  │
│ courseId (FK)    │◄──────│ userId (FK)      │
│ status           │       │ thumbnailImage   │
│ progressPct      │       └────────┬─────────┘
│ enrolledAt       │                │
│ completedAt      │                │ 1:N
└──────────────────┘                │
                           ┌────────┴─────────┐
┌──────────────────┐       │      Topic       │
│    Progress      │       ├──────────────────┤
├──────────────────┤       │ id (PK)          │
│ id (PK)          │       │ title            │
│ userId (FK)      │       │ status           │
│ courseId (FK)    │──────►│ completed        │
│ topicId (FK)     │◄──────│ courseId (FK)    │
│ completed        │       │ order            │
│ timeSpent        │       └────────┬─────────┘
│ completedAt      │                │
└──────────────────┘                │ 1:N
                                    │
┌──────────────────┐       ┌────────┴─────────┐
│      Quiz        │       │    Material      │
├──────────────────┤       ├──────────────────┤
│ id (PK)          │       │ id (PK)          │
│ courseId (FK)    │       │ type             │
│ topicId (FK)     │       │ title            │
│ title            │       │ uri              │
│ questions (JSON) │       │ description      │
│ passingScore     │       │ courseId (FK)    │
│ timeLimit        │       │ topicId (FK)     │
│ isActive         │       └──────────────────┘
└────────┬─────────┘
         │
         │ 1:N
┌────────┴─────────┐       ┌──────────────────┐
│   QuizResult     │       │   Certificate    │
├──────────────────┤       ├──────────────────┤
│ id (PK)          │       │ id (PK)          │
│ userId (FK)      │       │ userId (FK)      │
│ quizId (FK)      │       │ courseId (FK)    │
│ courseId (FK)    │       │ certificateNo    │
│ answers (JSON)   │       │ issuedDate       │
│ score            │       │ verificationUrl  │
│ passed           │       │ grade            │
│ timeTaken        │       └──────────────────┘
│ attemptNumber    │
└──────────────────┘       ┌──────────────────┐
                           │   Notification   │
┌──────────────────┐       ├──────────────────┤
│  AIChatSession   │       │ id (PK)          │
├──────────────────┤       │ userId (FK)      │
│ id (PK)          │       │ title            │
│ userId (FK)      │       │ message          │
│ title            │       │ type             │
│ lastMessageAt    │       │ isRead           │
└────────┬─────────┘       │ relatedId        │
         │                 │ relatedType      │
         │ 1:N             └──────────────────┘
┌────────┴─────────┐
│  AIChatMessage   │
├──────────────────┤
│ id (PK)          │
│ sessionId (FK)   │
│ content          │
│ sender           │
│ timestamp        │
└──────────────────┘
```

**Figure 4.19: Database Entity Relationship Diagram**

> **Screenshot to paste:** Create this ER diagram using MySQL Workbench, dbdiagram.io, or similar tool based on the schema above.

---

## API Endpoints Summary

### Authentication Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/auth/register` | Register new user |
| POST | `/api/auth/login` | Login with credentials |
| POST | `/api/auth/send-otp` | Send OTP for verification |
| POST | `/api/auth/verify-otp` | Verify OTP code |
| POST | `/api/auth/google-auth` | Google OAuth login |
| POST | `/api/auth/forgot-password` | Request password reset |
| POST | `/api/auth/reset-password` | Reset password |
| GET | `/api/auth/profile` | Get user profile |

### Course Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/courses` | Get all published courses |
| GET | `/api/courses/:id` | Get course details |
| POST | `/api/courses` | Create new course |
| PUT | `/api/courses/:id` | Update course |
| DELETE | `/api/courses/:id` | Delete course |
| PATCH | `/api/courses/:id/publish` | Publish/unpublish course |

### Enrollment Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/enrollments/my` | Get my enrollments |
| POST | `/api/enrollments` | Enroll in course |
| DELETE | `/api/enrollments/:courseId` | Unenroll from course |
| GET | `/api/enrollments/check/:courseId` | Check enrollment status |

### Progress Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/progress/my` | Get my progress |
| POST | `/api/progress/topic` | Update topic progress |
| GET | `/api/progress/stats` | Get learning statistics |

### Quiz Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/quizzes/course/:courseId` | Get course quizzes |
| GET | `/api/quizzes/:id` | Get quiz by ID |
| POST | `/api/quizzes/submit` | Submit quiz answers |
| GET | `/api/quizzes/results/my` | Get my quiz results |

### Certificate Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/certificates/my` | Get my certificates |
| POST | `/api/certificates` | Generate certificate |
| GET | `/api/certificates/verify/:id` | Verify certificate (public) |

---

## Screenshot Reference Guide

| Figure | Description | Screenshot Location |
|--------|-------------|---------------------|
| 4.1 | User Authentication Flow | Login screen with email/password fields |
| 4.2 | OTP Verification Screen | OTP input screen with 6 digit fields |
| 4.3 | Course Creation Form | Create course form with all fields |
| 4.4 | Course Listing Dashboard | Course cards with thumbnails and stats |
| 4.5 | Topic Management Interface | Topics list with add/reorder options |
| 4.6 | Course Enrollment Screen | Course detail with Enroll button |
| 4.7 | Student Progress Dashboard | Dashboard with progress bars and stats |
| 4.8 | Learning Screen | Topic list with completion checkmarks |
| 4.9 | Quiz Taking Interface | Quiz question with multiple choice options |
| 4.10 | Quiz Result Screen | Score display with pass/fail status |
| 4.11 | Certificate Display | Certificate with verification details |
| 4.12 | Certificate Verification | Public verification page |
| 4.13 | AI Chat Interface | Chat bubbles with AI responses |
| 4.14 | Notifications Screen | Notification list with status indicators |
| 4.15 | Admin Dashboard | Admin statistics and quick actions |
| 4.16 | User Management | User table with filters and actions |
| 4.17 | Category Management | Category list with CRUD operations |
| 4.18 | System Architecture | Architecture diagram |
| 4.19 | Database ER Diagram | Entity relationship diagram |

---

## Conclusion

SkillSphere LMS is a comprehensive learning management system that provides a complete solution for online education. The system's modular architecture allows for easy maintenance and scalability, while the multi-role access control ensures appropriate functionality for different user types.

Key highlights:
- **Scalable Architecture**: Separation of concerns with controllers, models, and services
- **Secure Authentication**: JWT-based auth with OTP verification and Google OAuth
- **Progress Tracking**: Real-time progress monitoring at topic level
- **AI Integration**: Google Gemini-powered learning assistant
- **Certificate System**: Unique certificates with public verification
- **Cross-Platform**: Web, Android, and iOS support through React Native

The system is deployed on Railway (backend) and Vercel (frontend), providing reliable and scalable hosting for production use.
